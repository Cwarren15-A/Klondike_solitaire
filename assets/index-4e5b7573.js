var e=Object.defineProperty,t=(t,a,s)=>(((t,a,s)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(t,"symbol"!=typeof a?a+"":a,s),s);import{r as a,b as s,R as i}from"./react-3d3f855c.js";import{c as n}from"./state-fae50fb7.js";import{s as r,r as o,a as c,i as l,d,g as u,b as h,m,t as p,c as g,l as f,f as v,w as y,L as x,e as b,h as j,j as w,k as N,n as k,o as S,p as C,q as P}from"./tensorflow-92d825d5.js";import{m as _}from"./animations-b0fd7e86.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var M={exports:{}},A={},T=a,I=Symbol.for("react.element"),O=Symbol.for("react.fragment"),D=Object.prototype.hasOwnProperty,F=T.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,E={key:!0,ref:!0,__self:!0,__source:!0};function z(e,t,a){var s,i={},n=null,r=null;for(s in void 0!==a&&(n=""+a),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(r=t.ref),t)D.call(t,s)&&!E.hasOwnProperty(s)&&(i[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===i[s]&&(i[s]=t[s]);return{$$typeof:I,type:e,key:n,ref:r,props:i,_owner:F.current}}A.Fragment=O,A.jsx=z,A.jsxs=z,M.exports=A;var R=M.exports,U={},G=s;U.createRoot=G.createRoot,U.hydrateRoot=G.hydrateRoot;const L=new Map,B=e=>{const t=L.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},H=(e,t={})=>(a,s,i)=>{const{enabled:n,anonymousActionType:r,store:o,...c}=t;let l;try{l=null!=n&&n&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(g){}if(!l)return e(a,s,i);const{connection:d,...u}=((e,t,a)=>{if(void 0===e)return{type:"untracked",connection:t.connect(a)};const s=L.get(a.name);if(s)return{type:"tracked",store:e,...s};const i={connection:t.connect(a),stores:{}};return L.set(a.name,i),{type:"tracked",store:e,...i}})(o,l,c);let h=!0;i.setState=(e,t,n)=>{const l=a(e,t);if(!h)return l;const u=void 0===n?{type:r||"anonymous"}:"string"==typeof n?{type:n}:n;return void 0===o?(null==d||d.send(u,s()),l):(null==d||d.send({...u,type:`${o}/${u.type}`},{...B(c.name),[o]:i.getState()}),l)};const m=(...e)=>{const t=h;h=!1,a(...e),h=t},p=e(i.setState,s,i);if("untracked"===u.type?null==d||d.init(p):(u.stores[u.store]=i,null==d||d.init(Object.fromEntries(Object.entries(u.stores).map((([e,t])=>[e,e===u.store?p:t.getState()]))))),i.dispatchFromDevtools&&"function"==typeof i.dispatch){const e=i.dispatch;i.dispatch=(...t)=>{e(...t)}}return d.subscribe((e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return;return W(e.payload,(e=>{if("__setState"!==e.type)i.dispatchFromDevtools&&"function"==typeof i.dispatch&&i.dispatch(e);else{if(void 0===o)return void m(e.state);Object.keys(e.state).length;const t=e.state[o];if(null==t)return;JSON.stringify(i.getState())!==JSON.stringify(t)&&m(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return m(p),void 0===o?null==d?void 0:d.init(i.getState()):null==d?void 0:d.init(B(c.name));case"COMMIT":return void 0===o?void(null==d||d.init(i.getState())):null==d?void 0:d.init(B(c.name));case"ROLLBACK":return W(e.state,(e=>{if(void 0===o)return m(e),void(null==d||d.init(i.getState()));m(e[o]),null==d||d.init(B(c.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return W(e.state,(e=>{void 0!==o?JSON.stringify(i.getState())!==JSON.stringify(e[o])&&m(e[o]):m(e)}));case"IMPORT_STATE":{const{nextLiftedState:a}=e.payload,s=null==(t=a.computedStates.slice(-1)[0])?void 0:t.state;if(!s)return;return m(void 0===o?s:s[o]),void(null==d||d.send(null,a))}case"PAUSE_RECORDING":return h=!h}return}})),p},W=(e,t)=>{let a;try{a=JSON.parse(e)}catch(s){}void 0!==a&&t(a)};function V(e,t){let a;try{a=e()}catch(s){return}return{getItem:e=>{var s;const i=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),n=null!=(s=a.getItem(e))?s:null;return n instanceof Promise?n.then(i):i(n)},setItem:(e,s)=>a.setItem(e,JSON.stringify(s,null==t?void 0:t.replacer)),removeItem:e=>a.removeItem(e)}}const q=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>q(e)(a),catch(e){return this}}}catch(a){return{then(e){return this},catch:e=>q(e)(a)}}},$=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((e,t)=>(a,s,i)=>{let n={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},r=!1;const o=new Set,c=new Set;let l;try{l=n.getStorage()}catch(f){}if(!l)return e(((...e)=>{a(...e)}),s,i);const d=q(n.serialize),u=()=>{const e=n.partialize({...s()});let t;const a=d({state:e,version:n.version}).then((e=>l.setItem(n.name,e))).catch((e=>{t=e}));if(t)throw t;return a},h=i.setState;i.setState=(e,t)=>{h(e,t),u()};const m=e(((...e)=>{a(...e),u()}),s,i);let p;const g=()=>{var e;if(!l)return;r=!1,o.forEach((e=>e(s())));const t=(null==(e=n.onRehydrateStorage)?void 0:e.call(n,s()))||void 0;return q(l.getItem.bind(l))(n.name).then((e=>{if(e)return n.deserialize(e)})).then((e=>{if(e){if("number"!=typeof e.version||e.version===n.version)return e.state;if(n.migrate)return n.migrate(e.state,e.version)}})).then((e=>{var t;return p=n.merge(e,null!=(t=s())?t:m),a(p,!0),u()})).then((()=>{null==t||t(p,void 0),r=!0,c.forEach((e=>e(p)))})).catch((e=>{null==t||t(void 0,e)}))};return i.persist={setOptions:e=>{n={...n,...e},e.getStorage&&(l=e.getStorage())},clearStorage:()=>{null==l||l.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>g(),hasHydrated:()=>r,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},g(),p||m})(e,t):((e,t)=>(a,s,i)=>{let n={storage:V((()=>localStorage)),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},r=!1;const o=new Set,c=new Set;let l=n.storage;if(!l)return e(((...e)=>{a(...e)}),s,i);const d=()=>{const e=n.partialize({...s()});return l.setItem(n.name,{state:e,version:n.version})},u=i.setState;i.setState=(e,t)=>{u(e,t),d()};const h=e(((...e)=>{a(...e),d()}),s,i);let m;i.getInitialState=()=>h;const p=()=>{var e,t;if(!l)return;r=!1,o.forEach((e=>{var t;return e(null!=(t=s())?t:h)}));const i=(null==(t=n.onRehydrateStorage)?void 0:t.call(n,null!=(e=s())?e:h))||void 0;return q(l.getItem.bind(l))(n.name).then((e=>{if(e){if("number"!=typeof e.version||e.version===n.version)return[!1,e.state];if(n.migrate)return[!0,n.migrate(e.state,e.version)]}return[!1,void 0]})).then((e=>{var t;const[i,r]=e;if(m=n.merge(r,null!=(t=s())?t:h),a(m,!0),i)return d()})).then((()=>{null==i||i(m,void 0),m=s(),r=!0,c.forEach((e=>e(m)))})).catch((e=>{null==i||i(void 0,e)}))};return i.persist={setOptions:e=>{n={...n,...e},e.storage&&(l=e.storage)},clearStorage:()=>{null==l||l.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>p(),hasHydrated:()=>r,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},n.skipHydration||p(),m||h})(e,t);var J=Symbol.for("immer-nothing"),K=Symbol.for("immer-draftable"),Q=Symbol.for("immer-state");function Y(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var X=Object.getPrototypeOf;function Z(e){return!!e&&!!e[Q]}function ee(e){return!!e&&(ae(e)||Array.isArray(e)||!!e[K]||!!e.constructor?.[K]||oe(e)||ce(e))}var te=Object.prototype.constructor.toString();function ae(e){if(!e||"object"!=typeof e)return!1;const t=X(e);if(null===t)return!0;const a=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return a===Object||"function"==typeof a&&Function.toString.call(a)===te}function se(e,t){0===ie(e)?Reflect.ownKeys(e).forEach((a=>{t(a,e[a],e)})):e.forEach(((a,s)=>t(s,a,e)))}function ie(e){const t=e[Q];return t?t.type_:Array.isArray(e)?1:oe(e)?2:ce(e)?3:0}function ne(e,t){return 2===ie(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function re(e,t,a){const s=ie(e);2===s?e.set(t,a):3===s?e.add(a):e[t]=a}function oe(e){return e instanceof Map}function ce(e){return e instanceof Set}function le(e){return e.copy_||e.base_}function de(e,t){if(oe(e))return new Map(e);if(ce(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const a=ae(e);if(!0===t||"class_only"===t&&!a){const t=Object.getOwnPropertyDescriptors(e);delete t[Q];let a=Reflect.ownKeys(t);for(let s=0;s<a.length;s++){const i=a[s],n=t[i];!1===n.writable&&(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(t[i]={configurable:!0,writable:!0,enumerable:n.enumerable,value:e[i]})}return Object.create(X(e),t)}{const t=X(e);if(null!==t&&a)return{...e};const s=Object.create(t);return Object.assign(s,e)}}function ue(e,t=!1){return me(e)||Z(e)||!ee(e)||(ie(e)>1&&(e.set=e.add=e.clear=e.delete=he),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>ue(t,!0)))),e}function he(){Y(2)}function me(e){return Object.isFrozen(e)}var pe,ge={};function fe(e){const t=ge[e];return t||Y(0),t}function ve(){return pe}function ye(e,t){t&&(fe("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function xe(e){be(e),e.drafts_.forEach(we),e.drafts_=null}function be(e){e===pe&&(pe=e.parent_)}function je(e){return pe={drafts_:[],parent_:pe,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function we(e){const t=e[Q];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function Ne(e,t){t.unfinalizedDrafts_=t.drafts_.length;const a=t.drafts_[0];return void 0!==e&&e!==a?(a[Q].modified_&&(xe(t),Y(4)),ee(e)&&(e=ke(t,e),t.parent_||Ce(t,e)),t.patches_&&fe("Patches").generateReplacementPatches_(a[Q].base_,e,t.patches_,t.inversePatches_)):e=ke(t,a,[]),xe(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==J?e:void 0}function ke(e,t,a){if(me(t))return t;const s=t[Q];if(!s)return se(t,((i,n)=>Se(e,s,t,i,n,a))),t;if(s.scope_!==e)return t;if(!s.modified_)return Ce(e,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const t=s.copy_;let i=t,n=!1;3===s.type_&&(i=new Set(t),t.clear(),n=!0),se(i,((i,r)=>Se(e,s,t,i,r,a,n))),Ce(e,t,!1),a&&e.patches_&&fe("Patches").generatePatches_(s,a,e.patches_,e.inversePatches_)}return s.copy_}function Se(e,t,a,s,i,n,r){if(Z(i)){const r=ke(e,i,n&&t&&3!==t.type_&&!ne(t.assigned_,s)?n.concat(s):void 0);if(re(a,s,r),!Z(r))return;e.canAutoFreeze_=!1}else r&&a.add(i);if(ee(i)&&!me(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;ke(e,i),t&&t.scope_.parent_||"symbol"==typeof s||!Object.prototype.propertyIsEnumerable.call(a,s)||Ce(e,i)}}function Ce(e,t,a=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&ue(t,a)}var Pe={get(e,t){if(t===Q)return e;const a=le(e);if(!ne(a,t))return function(e,t,a){const s=Ae(t,a);return s?"value"in s?s.value:s.get?.call(e.draft_):void 0}(e,a,t);const s=a[t];return e.finalized_||!ee(s)?s:s===Me(e.base_,t)?(Ie(e),e.copy_[t]=Oe(s,e)):s},has:(e,t)=>t in le(e),ownKeys:e=>Reflect.ownKeys(le(e)),set(e,t,a){const s=Ae(le(e),t);if(s?.set)return s.set.call(e.draft_,a),!0;if(!e.modified_){const s=Me(le(e),t),r=s?.[Q];if(r&&r.base_===a)return e.copy_[t]=a,e.assigned_[t]=!1,!0;if(((i=a)===(n=s)?0!==i||1/i==1/n:i!=i&&n!=n)&&(void 0!==a||ne(e.base_,t)))return!0;Ie(e),Te(e)}var i,n;return e.copy_[t]===a&&(void 0!==a||t in e.copy_)||Number.isNaN(a)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=a,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==Me(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,Ie(e),Te(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const a=le(e),s=Reflect.getOwnPropertyDescriptor(a,t);return s?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:s.enumerable,value:a[t]}:s},defineProperty(){Y(11)},getPrototypeOf:e=>X(e.base_),setPrototypeOf(){Y(12)}},_e={};function Me(e,t){const a=e[Q];return(a?le(a):e)[t]}function Ae(e,t){if(!(t in e))return;let a=X(e);for(;a;){const e=Object.getOwnPropertyDescriptor(a,t);if(e)return e;a=X(a)}}function Te(e){e.modified_||(e.modified_=!0,e.parent_&&Te(e.parent_))}function Ie(e){e.copy_||(e.copy_=de(e.base_,e.scope_.immer_.useStrictShallowCopy_))}se(Pe,((e,t)=>{_e[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),_e.deleteProperty=function(e,t){return _e.set.call(this,e,t,void 0)},_e.set=function(e,t,a){return Pe.set.call(this,e[0],t,a,e[0])};function Oe(e,t){const a=oe(e)?fe("MapSet").proxyMap_(e,t):ce(e)?fe("MapSet").proxySet_(e,t):function(e,t){const a=Array.isArray(e),s={type_:a?1:0,scope_:t?t.scope_:ve(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=s,n=Pe;a&&(i=[s],n=_e);const{revoke:r,proxy:o}=Proxy.revocable(i,n);return s.draft_=o,s.revoke_=r,o}(e,t);return(t?t.scope_:ve()).drafts_.push(a),a}function De(e){if(!ee(e)||me(e))return e;const t=e[Q];let a;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,a=de(e,t.scope_.immer_.useStrictShallowCopy_)}else a=de(e,!0);return se(a,((e,t)=>{re(a,e,De(t))})),t&&(t.finalized_=!1),a}var Fe=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,a)=>{if("function"==typeof e&&"function"!=typeof t){const a=t;t=e;const s=this;return function(e=a,...i){return s.produce(e,(e=>t.call(this,e,...i)))}}let s;if("function"!=typeof t&&Y(6),void 0!==a&&"function"!=typeof a&&Y(7),ee(e)){const i=je(this),n=Oe(e,void 0);let r=!0;try{s=t(n),r=!1}finally{r?xe(i):be(i)}return ye(i,a),Ne(s,i)}if(!e||"object"!=typeof e){if(s=t(e),void 0===s&&(s=e),s===J&&(s=void 0),this.autoFreeze_&&ue(s,!0),a){const t=[],i=[];fe("Patches").generateReplacementPatches_(e,s,t,i),a(t,i)}return s}Y(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...a)=>this.produceWithPatches(t,(t=>e(t,...a)));let a,s;return[this.produce(e,t,((e,t)=>{a=e,s=t})),a,s]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){ee(e)||Y(8),Z(e)&&(e=function(e){Z(e)||Y(10);return De(e)}(e));const t=je(this),a=Oe(e,void 0);return a[Q].isManual_=!0,be(t),a}finishDraft(e,t){const a=e&&e[Q];a&&a.isManual_||Y(9);const{scope_:s}=a;return ye(s,t),Ne(void 0,s)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let a;for(a=t.length-1;a>=0;a--){const s=t[a];if(0===s.path.length&&"replace"===s.op){e=s.value;break}}a>-1&&(t=t.slice(a+1));const s=fe("Patches").applyPatches_;return Z(e)?s(e,t):this.produce(e,(e=>s(e,t)))}},Ee=Fe.produce;Fe.produceWithPatches.bind(Fe),Fe.setAutoFreeze.bind(Fe),Fe.setUseStrictShallowCopy.bind(Fe),Fe.applyPatches.bind(Fe),Fe.createDraft.bind(Fe),Fe.finishDraft.bind(Fe);const ze=e=>(t,a,s)=>(s.setState=(e,a,...s)=>{const i="function"==typeof e?Ee(e):e;return t(i,a,...s)},e(s.setState,a,s)),Re=()=>{const e=Ue(),t=Ge(e),a=Le(t);return{stock:a.stock,waste:[],tableau:a.tableau,foundations:{"♠":[],"♥":[],"♦":[],"♣":[]},drawMode:1,gameHistory:[],gameStats:{moves:0,time:0,score:0},redoHistory:[],hintCardId:null,hoveredCard:null}},Ue=()=>{const e=["♠","♥","♦","♣"],t=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],a=[];for(const s of e)for(const e of t)a.push({id:`${s}-${e}`,suit:s,rank:e,value:"A"===e?1:"J"===e?11:"Q"===e?12:"K"===e?13:parseInt(e),faceUp:!1});return a},Ge=e=>{const t=[...e];for(let a=t.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[t[a],t[e]]=[t[e],t[a]]}return t},Le=e=>{const t=Array(7).fill(null).map((()=>[])),a=[];let s=0;for(let i=0;i<7;i++)for(let a=i;a<7;a++){const n={...e[s]};n.faceUp=a===i,t[a].push(n),s++}for(let i=s;i<e.length;i++)a.push({...e[i],faceUp:!1});return{tableau:t,stock:a}};class Be{createNewGame(e=1){return Re()}makeMove(e,t){const a={...e};return a.gameHistory.push(t),a.gameStats.moves++,{success:!0,newState:a}}isGameWon(e){return Object.values(e.foundations).every((e=>13===e.length))}calculateWinProbability(e){return Object.values(e.foundations).reduce(((e,t)=>e+t.length),0)/52}isValidMove(e,t){return!0}getPossibleMoves(e){return[]}createDeck(){const e=["♠","♥","♦","♣"],t=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],a=[];let s=1;for(const i of e)for(let e=0;e<t.length;e++){const n=t[e],r="A"===n?1:"J"===n?11:"Q"===n?12:"K"===n?13:parseInt(n);a.push({id:"card-"+s++,suit:i,rank:n,value:r,faceUp:!1})}return this.shuffleDeck(a)}shuffleDeck(e){const t=[...e];for(let a=t.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[t[a],t[e]]=[t[e],t[a]]}return t}moveToFoundation(e,t){const a=this.findCard(e,t.cardId);if(!a)return{success:!1,newState:e,error:"Card not found"};const s=e.foundations[a.suit];return 0===s.length&&"A"!==a.rank?{success:!1,newState:e,error:"Only Ace can be placed on empty foundation"}:s.length>0&&a.value!==s[s.length-1].value+1?{success:!1,newState:e,error:"Card must be next in sequence"}:(this.removeCardFromSource(e,a),s.push(a),e.gameStats.moves++,e.gameStats.score+=10,this.revealHiddenCards(e),{success:!0,newState:e})}moveToTableau(e,t){const a=this.findCard(e,t.cardId);if(!a||void 0===t.targetIndex)return{success:!1,newState:e,error:"Invalid move parameters"};const s=e.tableau[t.targetIndex];if(!this.canMoveToTableau(a,s))return{success:!1,newState:e,error:"Invalid tableau move"};const i=this.getCardsToMove(e,a);return i.forEach((t=>this.removeCardFromSource(e,t))),s.push(...i),e.gameStats.moves++,e.gameStats.score+=i.length,this.revealHiddenCards(e),{success:!0,newState:e}}moveWasteToTableau(e,t){if(0===e.waste.length||void 0===t.targetIndex)return{success:!1,newState:e,error:"No waste card or invalid target"};const a=e.waste[e.waste.length-1],s=e.tableau[t.targetIndex];return this.canMoveToTableau(a,s)?(e.waste.pop(),s.push(a),e.gameStats.moves++,e.gameStats.score+=5,{success:!0,newState:e}):{success:!1,newState:e,error:"Cannot move waste card to tableau"}}moveFoundationToTableau(e,t){const a=this.findCard(e,t.cardId);if(!a||void 0===t.targetIndex)return{success:!1,newState:e,error:"Invalid move parameters"};const s=e.tableau[t.targetIndex];if(!this.canMoveToTableau(a,s))return{success:!1,newState:e,error:"Cannot move foundation card to tableau"};return e.foundations[a.suit].pop(),s.push(a),e.gameStats.moves++,e.gameStats.score-=15,{success:!0,newState:e}}flipStock(e){if(0===e.stock.length)e.stock=[...e.waste.reverse()],e.waste=[],e.stock.forEach((e=>e.faceUp=!1));else{const t=Math.min(e.drawMode,e.stock.length);for(let a=0;a<t;a++){const t=e.stock.pop();t&&(t.faceUp=!0,e.waste.push(t))}}return e.gameStats.moves++,{success:!0,newState:e}}canMoveToTableau(e,t){if(0===t.length)return"K"===e.rank;const a=t[t.length-1];if(!a.faceUp)return!1;const s="♥"===e.suit||"♦"===e.suit,i="♥"===a.suit||"♦"===a.suit;return e.value===a.value-1&&s!==i}findCard(e,t){return[...e.stock,...e.waste,...e.tableau.flat(),...Object.values(e.foundations).flat()].find((e=>e.id===t))||null}removeCardFromSource(e,t){const a=e.stock.findIndex((e=>e.id===t.id));if(-1!==a)return void e.stock.splice(a,1);const s=e.waste.findIndex((e=>e.id===t.id));if(-1===s){for(const a of e.tableau){const e=a.findIndex((e=>e.id===t.id));if(-1!==e)return void a.splice(e,1)}for(const a of Object.values(e.foundations)){const e=a.findIndex((e=>e.id===t.id));if(-1!==e)return void a.splice(e,1)}}else e.waste.splice(s,1)}getCardsToMove(e,t){for(const a of e.tableau){const e=a.findIndex((e=>e.id===t.id));if(-1!==e)return a.slice(e)}return[t]}revealHiddenCards(e){for(const t of e.tableau)if(t.length>0){const a=t[t.length-1];a.faceUp||(a.faceUp=!0,e.gameStats.score+=5)}}getAllPossibleMoves(e){const t=[];if(e.tableau.forEach(((a,s)=>{if(a.length>0){const i=a[a.length-1];if(i.faceUp){const a=e.foundations[i.suit];(0===a.length&&"A"===i.rank||a.length>0&&i.value===a[a.length-1].value+1)&&t.push({type:"foundation",cardId:i.id,sourceType:"tableau",targetType:"foundation",sourceIndex:s,description:`Move ${i.rank}${i.suit} to foundation`})}}})),e.tableau.forEach(((a,s)=>{if(a.length>0){const i=a[a.length-1];i.faceUp&&e.tableau.forEach(((e,a)=>{s!==a&&this.canMoveToTableau(i,e)&&t.push({type:"tableau",cardId:i.id,sourceType:"tableau",targetType:"tableau",sourceIndex:s,targetIndex:a,description:`Move ${i.rank}${i.suit} to tableau`})}))}})),e.waste.length>0){const a=e.waste[e.waste.length-1];e.tableau.forEach(((e,s)=>{this.canMoveToTableau(a,e)&&t.push({type:"waste-to-tableau",cardId:a.id,sourceType:"waste",targetType:"tableau",targetIndex:s,description:`Move ${a.rank}${a.suit} from waste`})}))}return t}deepCopyGameState(e){return{stock:e.stock.map((e=>({...e}))),waste:e.waste.map((e=>({...e}))),tableau:e.tableau.map((e=>e.map((e=>({...e}))))),foundations:{"♠":[...e.foundations["♠"]],"♥":[...e.foundations["♥"]],"♦":[...e.foundations["♦"]],"♣":[...e.foundations["♣"]]},drawMode:e.drawMode,gameStats:{...e.gameStats},gameHistory:[...e.gameHistory],redoHistory:[...e.redoHistory],hintCardId:e.hintCardId,hoveredCard:e.hoveredCard}}}const He=class e extends x{constructor(e){super({}),t(this,"numHeads"),t(this,"headDim"),t(this,"hiddenDim"),t(this,"dropoutRate"),t(this,"wq"),t(this,"wk"),t(this,"wv"),t(this,"wo"),t(this,"ffn"),t(this,"layerNorm1"),t(this,"layerNorm2"),this.numHeads=e.numHeads,this.headDim=e.headDim,this.hiddenDim=e.hiddenDim,this.dropoutRate=e.dropoutRate||.1,this.initializeLayers()}initializeLayers(){this.wq=b({layers:[d({units:this.numHeads*this.headDim,activation:"linear"})]}),this.wk=b({layers:[d({units:this.numHeads*this.headDim,activation:"linear"})]}),this.wv=b({layers:[d({units:this.numHeads*this.headDim,activation:"linear"})]}),this.wo=b({layers:[d({units:this.hiddenDim,activation:"linear"})]}),this.ffn=b({layers:[d({units:4*this.hiddenDim,activation:"relu"}),h({rate:this.dropoutRate}),d({units:this.hiddenDim,activation:"linear"})]}),this.layerNorm1=b({layers:[j()]}),this.layerNorm2=b({layers:[j()]})}call(e){if(!(this.wq&&this.wk&&this.wv&&this.wo&&this.ffn&&this.layerNorm1&&this.layerNorm2))throw new Error("Layers not initialized");const t=this.wq.apply(e),a=this.wk.apply(e),s=this.wv.apply(e),i=this.scaledDotProductAttention(t,a,s),n=this.wo.apply(i),r=this.layerNorm1.apply(w(e,n)),o=this.ffn.apply(r);return this.layerNorm2.apply(w(r,o))}scaledDotProductAttention(e,t,a){const s=N(e,t,!1,!0),i=k(s,Math.sqrt(this.headDim)),n=S(i,-1);return N(n,a)}getClassName(){return e.className}};t(He,"className","GraphTransformerLayer");let We=He;const Ve=class e extends x{constructor(e){super({}),t(this,"degree"),t(this,"hiddenDim"),t(this,"polynomialWeights"),t(this,"combinationLayer"),t(this,"outputProjection"),this.degree=e.degree,this.hiddenDim=e.hiddenDim,this.initializeLayers()}initializeLayers(){this.polynomialWeights=[];for(let e=1;e<=this.degree;e++)this.polynomialWeights.push(b({layers:[d({units:this.hiddenDim,activation:"linear",kernelInitializer:"glorotUniform"})]}));this.combinationLayer=b({layers:[d({units:2*this.hiddenDim,activation:"relu"}),h({rate:.1}),d({units:this.hiddenDim,activation:"linear"})]}),this.outputProjection=b({layers:[j(),d({units:this.hiddenDim,activation:"relu"})]})}call(e){if(!this.polynomialWeights||!this.combinationLayer||!this.outputProjection)throw new Error("Layers not initialized");const t=[];for(let n=1;n<=this.degree;n++){let a=e;for(let t=1;t<n;t++)a=C(a,e);const s=this.polynomialWeights[n-1].apply(a);t.push(s)}const a=P(t,-1),s=this.combinationLayer.apply(a),i=w(e,s);return this.outputProjection.apply(i)}getClassName(){return e.className}};t(Ve,"className","PolynormerLayer");let qe=Ve;class $e{constructor(){t(this,"model",null),t(this,"isInitialized",!1),t(this,"isTraining",!1),t(this,"modelVersion","2.0.0-graph-transformer"),t(this,"graphTransformerLayers",[]),t(this,"polynormerLayers",[]),t(this,"_trainingData",[]),this.initializeBackend(),this.registerCustomLayers()}async initializeBackend(){await r("webgl"),await o()}registerCustomLayers(){c(We),c(qe)}async initialize(){try{await this.loadModel()}catch(e){await this.createAdvancedModel()}this.isInitialized=!0}async createAdvancedModel(){const e=l({shape:[52,128]});let t=d({units:256,activation:"relu",name:"card_embedding"}).apply(e);for(let l=0;l<3;l++){const e=new We({numHeads:8,headDim:32,hiddenDim:256,dropoutRate:.1});t=e.apply(t),this.graphTransformerLayers.push(e)}let a=t;for(let l=0;l<2;l++){const e=new qe({degree:3,hiddenDim:256});a=e.apply(a),this.polynormerLayers.push(e)}const s=u().apply(a),i=d({units:512,activation:"relu",name:"strategic_reasoning"}).apply(s),n=h({rate:.3}).apply(i),r=d({units:256,activation:"relu",name:"deep_reasoning"}).apply(n),o=d({units:1,activation:"sigmoid",name:"win_probability"}).apply(r),c=d({units:64,activation:"softmax",name:"move_scores"}).apply(r),g=d({units:3,activation:"softmax",name:"difficulty_estimate"}).apply(r);this.model=m({inputs:e,outputs:[o,c,g]});const f=p.adamax(.001);this.model.compile({optimizer:f,loss:{win_probability:"binaryCrossentropy",move_scores:"categoricalCrossentropy",difficulty_estimate:"categoricalCrossentropy"},metrics:["accuracy","meanSquaredError"]})}gameStateToGraph(e){const t=[],a=[];let s=0;return e.stock.forEach(((e,a)=>{t.push({id:`stock_${s}`,features:this.cardToFeatures(e,"stock",a),cardType:`${e.rank}_${e.suit}`,position:[0,a],connections:[]}),s++})),this.createGameEdges(t,a),{nodes:t,edges:a}}cardToFeatures(e,t,a){const s=new Array(128).fill(0);s[this.getCardId(e)]=1;return s[{stock:52,waste:53,tableau:54,foundation:55}[t]||52]=1,s[60]=a/20,s[68]=e.faceUp?1:0,s[69]=e.value/13,s[70]="♠"===e.suit?1:0,s[71]="♥"===e.suit?1:0,s[72]="♦"===e.suit?1:0,s[73]="♣"===e.suit?1:0,s[74]="♥"===e.suit||"♦"===e.suit?1:0,s[75]="♠"===e.suit||"♣"===e.suit?1:0,s}createGameEdges(e,t){for(let a=0;a<Math.min(e.length,10);a++)for(let s=a+1;s<Math.min(e.length,10);s++)Math.random()>.7&&t.push({source:e[a].id,target:e[s].id,weight:Math.random(),edgeType:"strategic"})}getCardId(e){return 13*["♠","♥","♦","♣"].indexOf(e.suit)+["A","2","3","4","5","6","7","8","9","10","J","Q","K"].indexOf(e.rank)}graphToTensor(e){const t=[];for(let a=0;a<52;a++)a<e.nodes.length?t.push(e.nodes[a].features):t.push(new Array(128).fill(0));return g([t],[1,52,128])}async getGameAnalysis(e){if(!this.model||!this.isInitialized)return this.getFallbackAnalysis();try{const t=this.gameStateToGraph(e),a=this.graphToTensor(t),s=this.model.predict(a),i=await s[0].data(),n=await s[1].data(),r=i[0],o=this.calculateConfidence(Array.from(n)),c=await this.getBestMove(e);return a.dispose(),s.forEach((e=>e.dispose())),{winProbability:r,confidence:o,bestMove:c,difficulty:this.mapDifficultyFromProbability(r),recommendation:this.generateAdvancedRecommendation(c,r),strategicInsights:this.generateStrategicInsights(e),moveQuality:this.analyzeMoveQuality(c)}}catch(t){return this.getFallbackAnalysis()}}async getBestMove(e){const t=this.generatePossibleMoves(e);return 0===t.length?null:t[0]}generatePossibleMoves(e){const t=[];return t.push({type:"foundation",cardId:"example-card",sourceType:"waste",targetType:"foundation"}),t}generateAdvancedRecommendation(e,t){return e?`🎯 Recommended: Move card ${e.cardId} • Win probability: ${(100*t).toFixed(1)}%`:"🤔 No immediate moves available. Consider using the stock pile or undoing recent moves."}generateStrategicInsights(e){const t=[],a=this.analyzeFoundationProgress(e);a>.7?t.push("🏆 Excellent foundation progress - victory is near!"):a<.2&&t.push("🔧 Build foundations first - focus on Aces and low cards");return this.countBlockedCards(e)>15&&t.push("🚧 Many cards blocked - prioritize revealing tableau cards"),t}analyzeFoundationProgress(e){return Object.values(e.foundations).reduce(((e,t)=>e+t.length),0)/52}countBlockedCards(e){let t=0;return e.tableau.forEach((e=>{for(let a=0;a<e.length-1;a++)e[a].faceUp||t++})),t}mapDifficultyFromProbability(e){return e>.7?"Easy":e>.4?"Medium":"Hard"}calculateConfidence(e){return Math.max(...e)-Math.min(...e)}analyzeMoveQuality(e){return e?.5:0}getFallbackAnalysis(){return{winProbability:.5,confidence:.3,bestMove:null,difficulty:"Medium",recommendation:"🤖 Basic analysis mode - Graph Transformer unavailable",strategicInsights:["🔄 Advanced AI features loading..."],moveQuality:.5}}async trainOnGameResult(e,t){if(this.model&&!this.isTraining){this.isTraining=!0;try{this._trainingData.push({gameState:e[0]||{},outcome:t,moveQuality:.5}),await new Promise((e=>setTimeout(e,100))),this._trainingData.length%10==0&&await this.saveModel()}catch(a){}finally{this.isTraining=!1}}}async loadModel(){try{const e=localStorage.getItem("klondike-solitaire-graph-model");if(e){const{modelJson:t,weightsData:a}=JSON.parse(e);return void(this.model=await f(v(t,a)))}this.model=await f("indexeddb://klondike-solitaire-graph-model")}catch(e){throw new Error("No saved Graph Transformer model found")}}async saveModel(){if(this.model)try{await this.model.save("indexeddb://klondike-solitaire-graph-model"),await this.model.save(y((async e=>{const t={modelJson:e.modelTopology,weightsData:e.weightData,version:this.modelVersion,timestamp:Date.now(),architecture:"GraphTransformer+Polynormer"};return localStorage.setItem("klondike-solitaire-graph-model",JSON.stringify(t)),{modelArtifactsInfo:{dateSaved:new Date,modelTopologyType:"JSON"}}})))}catch(e){}}get modelState(){return{isInitialized:this.isInitialized,isTraining:this.isTraining,modelVersion:this.modelVersion,architecture:"Graph Transformer + Polynormer",parameters:this.model?.countParams()||0,graphLayers:this.graphTransformerLayers.length,polynormerLayers:this.polynormerLayers.length,trainingDataSize:this._trainingData.length}}dispose(){this.model&&this.model.dispose(),this.graphTransformerLayers.forEach((()=>{})),this.polynormerLayers.forEach((()=>{}))}}class Je{constructor(){t(this,"achievements",{}),this.initializeAchievements()}initializeAchievements(){this.achievements={"first-win":{id:"first-win",name:"First Victory",description:"Win your first game of Klondike Solitaire",icon:"🏆",category:"basic",unlocked:!1},"speed-demon":{id:"speed-demon",name:"Speed Demon",description:"Win a game in under 2 minutes",icon:"⚡",category:"time",unlocked:!1},perfectionist:{id:"perfectionist",name:"Perfectionist",description:"Win a game without using undo",icon:"💎",category:"skill",unlocked:!1},"streak-5":{id:"streak-5",name:"Win Streak",description:"Win 5 games in a row",icon:"🔥",category:"streak",unlocked:!1},"streak-10":{id:"streak-10",name:"Hot Streak",description:"Win 10 games in a row",icon:"🌟",category:"streak",unlocked:!1},"high-scorer":{id:"high-scorer",name:"High Scorer",description:"Score over 1000 points in a single game",icon:"💯",category:"score",unlocked:!1},"patient-player":{id:"patient-player",name:"Patient Player",description:"Win a game with over 500 moves",icon:"🧘",category:"patience",unlocked:!1},minimalist:{id:"minimalist",name:"Minimalist",description:"Win a game with fewer than 100 moves",icon:"🎯",category:"efficiency",unlocked:!1},"foundation-master":{id:"foundation-master",name:"Foundation Master",description:"Complete all foundations in order (A-K)",icon:"🏛️",category:"skill",unlocked:!1},"night-owl":{id:"night-owl",name:"Night Owl",description:"Win a game between midnight and 6 AM",icon:"🦉",category:"time",unlocked:!1},persistent:{id:"persistent",name:"Persistent",description:"Play 100 games",icon:"🏃",category:"dedication",unlocked:!1,progress:0,maxProgress:100},dedicated:{id:"dedicated",name:"Dedicated",description:"Play 500 games",icon:"🎖️",category:"dedication",unlocked:!1,progress:0,maxProgress:500},legend:{id:"legend",name:"Legend",description:"Play 1000 games",icon:"👑",category:"dedication",unlocked:!1,progress:0,maxProgress:1e3},"win-rate-50":{id:"win-rate-50",name:"Consistent Winner",description:"Maintain a 50% win rate over 20 games",icon:"📊",category:"skill",unlocked:!1},"win-rate-75":{id:"win-rate-75",name:"Master Player",description:"Maintain a 75% win rate over 20 games",icon:"🎓",category:"skill",unlocked:!1},"theme-explorer":{id:"theme-explorer",name:"Theme Explorer",description:"Try all 4 themes",icon:"🎨",category:"exploration",unlocked:!1,progress:0,maxProgress:4},"no-stock":{id:"no-stock",name:"No Stock Needed",description:"Win without ever flipping the stock pile",icon:"🚫",category:"skill",unlocked:!1},revealer:{id:"revealer",name:"The Revealer",description:"Reveal all face-down cards in a single game",icon:"👁️",category:"exploration",unlocked:!1}}}initialize(e){this.achievements.persistent&&(this.achievements.persistent.progress=e.gamesPlayed,this.achievements.persistent.unlocked=e.gamesPlayed>=100),this.achievements.dedicated&&(this.achievements.dedicated.progress=e.gamesPlayed,this.achievements.dedicated.unlocked=e.gamesPlayed>=500),this.achievements.legend&&(this.achievements.legend.progress=e.gamesPlayed,this.achievements.legend.unlocked=e.gamesPlayed>=1e3),e.achievements.forEach((e=>{this.achievements[e]&&(this.achievements[e].unlocked=!0,this.achievements[e].unlockedAt=Date.now())}))}checkAchievements(e,t){const a=[];return Object.values(this.achievements).forEach((s=>{!s.unlocked&&this.checkAchievement(s,e,t)&&(s.unlocked=!0,s.unlockedAt=Date.now(),a.push(s))})),a}checkAchievement(e,t,a){const s=new Date,i=t.gameStats.time,n=t.gameStats.moves,r=t.gameStats.score,o=this.isGameWon(t);switch(e.id){case"first-win":return o&&1===a.gamesWon;case"speed-demon":return o&&i<120;case"perfectionist":return o&&0===t.gameHistory.length;case"streak-5":return a.currentStreak>=5;case"streak-10":return a.currentStreak>=10;case"high-scorer":return r>1e3;case"patient-player":return o&&n>500;case"minimalist":return o&&n<100;case"foundation-master":return o&&this.checkFoundationOrder(t);case"night-owl":const e=s.getHours();return o&&e>=0&&e<6;case"persistent":return a.gamesPlayed>=100;case"dedicated":return a.gamesPlayed>=500;case"legend":return a.gamesPlayed>=1e3;case"win-rate-50":return a.gamesPlayed>=20&&a.winRate>=.5;case"win-rate-75":return a.gamesPlayed>=20&&a.winRate>=.75;case"theme-explorer":default:return!1;case"no-stock":return o&&!this.wasStockUsed(t);case"revealer":return o&&this.allCardsRevealed(t)}}isGameWon(e){return Object.values(e.foundations).every((e=>13===e.length))}checkFoundationOrder(e){return Object.values(e.foundations).every((e=>{if(13!==e.length)return!1;for(let t=0;t<e.length;t++){const a=t+1;if(e[t].value!==a)return!1}return!0}))}wasStockUsed(e){return e.waste.length>0}allCardsRevealed(e){return e.tableau.every((e=>e.every((e=>e.faceUp))))}getAchievements(){return this.achievements}getUnlockedAchievements(){return Object.values(this.achievements).filter((e=>e.unlocked))}getAchievementsByCategory(e){return Object.values(this.achievements).filter((t=>t.category===e))}getAchievementProgress(e){const t=this.achievements[e];return t&&t.maxProgress?Math.min((t.progress||0)/t.maxProgress,1):0}updateProgress(e,t){const a=this.achievements[e];a&&a.maxProgress&&(a.progress=Math.min(t,a.maxProgress),a.progress>=a.maxProgress&&!a.unlocked&&(a.unlocked=!0,a.unlockedAt=Date.now()))}getAchievementStats(){const e=Object.values(this.achievements),t={};return e.forEach((e=>{t[e.category]||(t[e.category]={total:0,unlocked:0}),t[e.category].total++,e.unlocked&&t[e.category].unlocked++})),{total:e.length,unlocked:e.filter((e=>e.unlocked)).length,categories:t}}}const Ke={difficulty:"medium",autoMoveToFoundation:!0,showMoveHints:!0,enableMLAnalysis:!0,adaptiveDifficulty:!1,drawMode:1,scoringMode:"standard",theme:"green",soundEnabled:!0,showWinProbability:!0},Qe={gamesPlayed:0,gamesWon:0,winRate:0,bestTime:0,bestScore:0,totalTime:0,averageTime:0,currentStreak:0,bestStreak:0,perfectGames:0,achievements:[]},Ye=n()(H($(ze(((e,t)=>{const a=new $e,s=new Be,i=new Je,n=Re();return{...n,gameState:n,selectedCard:null,hintCardId:null,isDragging:!1,draggedCard:null,currentView:"game",showHints:!1,isGameWon:!1,isGameLost:!1,mlAnalysis:null,settings:Ke,statistics:Qe,gameEngine:s,mlEngine:a,achievementSystem:i,canUndo:!1,canHint:!0,initializeGame:async()=>{await a.initialize(),e((e=>{const t=Re();Object.assign(e,t),e.gameState=t}))},newGame:()=>{e((e=>{const t=Re();Object.assign(e,t),e.gameState=t,e.selectedCard=null,e.hintCardId=null,e.isDragging=!1,e.draggedCard=null,e.isGameWon=!1,e.isGameLost=!1}))},makeMove:async s=>{const i=t();e((e=>{e.gameHistory.push({stock:[...e.stock],waste:[...e.waste],tableau:e.tableau.map((e=>[...e])),foundations:{...e.foundations},gameStats:{...e.gameStats}}),e.gameStats.moves++}));try{const t=await a.getGameAnalysis(i.gameState);e((e=>{e.mlAnalysis=t}))}catch(n){}},undoMove:()=>{e((e=>{if(e.gameHistory.length>0){const t=e.gameHistory.pop();t&&(e.stock=t.stock,e.waste=t.waste,e.tableau=t.tableau,e.foundations=t.foundations,e.gameStats=t.gameStats)}}))},redoMove:()=>{},getHint:async()=>{const a=t();try{const t=await a.mlEngine.getBestMove(a.gameState);return e((e=>{e.hintCardId=t?.cardId||null})),t}catch(s){return null}},getWinProbability:async()=>{const e=t();try{return(await e.mlEngine.getGameAnalysis(e.gameState)).winProbability||.5}catch(a){return.5}},selectCard:t=>{e((e=>{e.selectedCard=t}))},startDrag:t=>{e((e=>{e.isDragging=!0,e.draggedCard=t}))},endDrag:()=>{e((e=>{e.isDragging=!1,e.draggedCard=null}))},setCurrentView:t=>{e((e=>{e.currentView=t}))},updateSettings:t=>{e((e=>{Object.assign(e.settings,t)}))},toggleTheme:()=>{e((e=>{const t=["green","blue","dark","light"],a=(t.indexOf(e.settings.theme)+1)%t.length;e.settings.theme=t[a]}))},updateGameStats:t=>{e((e=>{e.statistics.gamesPlayed++,t&&e.statistics.gamesWon++,e.statistics.winRate=e.statistics.gamesWon/e.statistics.gamesPlayed}))},resetStatistics:()=>{e((e=>{Object.assign(e.statistics,Qe)}))}}})),{name:"klondike-solitaire-storage",partialize:e=>({settings:e.settings,statistics:e.statistics})}),{name:"klondike-solitaire-store"}));class Xe{constructor(){t(this,"gpu",{supported:!1}),t(this,"renderPipeline"),t(this,"computePipeline"),t(this,"particleBuffer"),t(this,"uniformBuffer"),t(this,"particleCount",0),t(this,"maxParticles",1e4),t(this,"cards",new Map),t(this,"isInitialized",!1),t(this,"fallbackCanvas"),t(this,"fallbackCtx"),t(this,"vertexShaderSource","\n    struct VertexInput {\n      @location(0) position: vec3<f32>,\n      @location(1) velocity: vec3<f32>,\n      @location(2) life: f32,\n      @location(3) color: vec4<f32>,\n      @location(4) size: f32,\n    }\n\n    struct VertexOutput {\n      @builtin(position) position: vec4<f32>,\n      @location(0) color: vec4<f32>,\n      @location(1) life: f32,\n    }\n\n    struct Uniforms {\n      mvpMatrix: mat4x4<f32>,\n      time: f32,\n      deltaTime: f32,\n      screenSize: vec2<f32>,\n    }\n\n    @group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\n    @vertex\n    fn vs_main(input: VertexInput) -> VertexOutput {\n      var output: VertexOutput;\n      \n      // Apply perspective projection\n      var worldPos = vec4<f32>(input.position, 1.0);\n      output.position = uniforms.mvpMatrix * worldPos;\n      \n      // Apply size based on distance and life\n      var sizeScale = input.size * input.life;\n      output.position.x += sizeScale * (gl_VertexIndex % 2u == 0u ? -1.0 : 1.0) * 0.01;\n      output.position.y += sizeScale * (gl_VertexIndex < 2u ? -1.0 : 1.0) * 0.01;\n      \n      output.color = input.color;\n      output.life = input.life;\n      \n      return output;\n    }\n  "),t(this,"fragmentShaderSource","\n    struct FragmentInput {\n      @location(0) color: vec4<f32>,\n      @location(1) life: f32,\n    }\n\n    @fragment\n    fn fs_main(input: FragmentInput) -> @location(0) vec4<f32> {\n      var center = vec2<f32>(0.5, 0.5);\n      var dist = distance(gl_FragCoord.xy / 100.0, center);\n      \n      // Create circular particles with soft edges\n      var alpha = smoothstep(0.5, 0.0, dist) * input.life;\n      \n      // Add sparkle effect for victory particles\n      var sparkle = sin(input.life * 10.0) * 0.3 + 0.7;\n      \n      var finalColor = input.color;\n      finalColor.a *= alpha * sparkle;\n      \n      return finalColor;\n    }\n  "),t(this,"computeShaderSource","\n    struct Particle {\n      position: vec3<f32>,\n      velocity: vec3<f32>,\n      life: f32,\n      maxLife: f32,\n      color: vec4<f32>,\n      size: f32,\n      particleType: f32,\n    }\n\n    struct Uniforms {\n      deltaTime: f32,\n      time: f32,\n      gravity: vec3<f32>,\n      windForce: vec3<f32>,\n    }\n\n    @group(0) @binding(0) var<storage, read_write> particles: array<Particle>;\n    @group(0) @binding(1) var<uniform> uniforms: Uniforms;\n\n    @compute @workgroup_size(64)\n    fn cs_main(@builtin(global_invocation_id) id: vec3<u32>) {\n      let index = id.x;\n      if (index >= arrayLength(&particles)) {\n        return;\n      }\n\n      var particle = particles[index];\n      \n      if (particle.life <= 0.0) {\n        return;\n      }\n\n      // Update physics\n      particle.velocity += uniforms.gravity * uniforms.deltaTime;\n      particle.velocity += uniforms.windForce * sin(uniforms.time + f32(index)) * uniforms.deltaTime;\n      \n      // Apply air resistance\n      particle.velocity *= 0.995;\n      \n      // Update position\n      particle.position += particle.velocity * uniforms.deltaTime;\n      \n      // Update life\n      particle.life -= uniforms.deltaTime;\n      \n      // Sparkle effect for victory particles\n      if (particle.particleType == 0.0) { // Victory type\n        particle.size = 1.0 + sin(uniforms.time * 5.0 + f32(index)) * 0.5;\n        particle.color.a = particle.life / particle.maxLife * (0.7 + sin(uniforms.time * 3.0) * 0.3);\n      }\n      \n      // Glow effect for card placement\n      if (particle.particleType == 1.0) { // Card place type\n        particle.size = 0.5 + (1.0 - particle.life / particle.maxLife) * 2.0;\n      }\n\n      particles[index] = particle;\n    }\n  ")}async init(e){try{if(!navigator.gpu)return this.initFallback(e);const t=await navigator.gpu.requestAdapter({powerPreference:"high-performance",forceFallbackAdapter:!1});return this.gpu.adapter=t||void 0,this.gpu.adapter?(this.gpu.device=await this.gpu.adapter.requestDevice({requiredFeatures:["timestamp-query"],requiredLimits:{maxComputeWorkgroupStorageSize:16384,maxStorageBufferBindingSize:134217728}}),this.gpu.canvas=e,this.gpu.context=e.getContext("webgpu"),this.gpu.format=navigator.gpu.getPreferredCanvasFormat(),this.gpu.context.configure({device:this.gpu.device,format:this.gpu.format,alphaMode:"premultiplied"}),await this.createRenderPipeline(),await this.createComputePipeline(),this.createBuffers(),this.gpu.supported=!0,this.isInitialized=!0,!0):this.initFallback(e)}catch(t){return this.initFallback(e)}}async createRenderPipeline(){if(!this.gpu.device||!this.gpu.format)return;const e=this.gpu.device.createShaderModule({code:this.vertexShaderSource}),t=this.gpu.device.createShaderModule({code:this.fragmentShaderSource});this.renderPipeline=this.gpu.device.createRenderPipeline({layout:"auto",vertex:{module:e,entryPoint:"vs_main",buffers:[{arrayStride:48,attributes:[{format:"float32x3",offset:0,shaderLocation:0},{format:"float32x3",offset:12,shaderLocation:1},{format:"float32",offset:24,shaderLocation:2},{format:"float32x4",offset:28,shaderLocation:3},{format:"float32",offset:44,shaderLocation:4}]}]},fragment:{module:t,entryPoint:"fs_main",targets:[{format:this.gpu.format,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-strip"}})}async createComputePipeline(){if(!this.gpu.device)return;const e=this.gpu.device.createShaderModule({code:this.computeShaderSource});this.computePipeline=this.gpu.device.createComputePipeline({layout:"auto",compute:{module:e,entryPoint:"cs_main"}})}createBuffers(){this.gpu.device&&(this.particleBuffer=this.gpu.device.createBuffer({size:48*this.maxParticles,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.uniformBuffer=this.gpu.device.createBuffer({size:256,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}))}initFallback(e){return this.fallbackCanvas=e,this.fallbackCtx=e.getContext("2d")||void 0,this.gpu.supported=!1,!0}createVictoryParticles(e,t,a=100){if(!this.gpu.supported)return this.createFallbackParticles(e,t,a,"victory");const s=new Float32Array(12*a);for(let i=0;i<a;i++){const a=12*i;s[a]=e+20*(Math.random()-.5),s[a+1]=t+20*(Math.random()-.5),s[a+2]=10*Math.random(),s[a+3]=200*(Math.random()-.5),s[a+4]=200*(Math.random()-.5)-100,s[a+5]=50*(Math.random()-.5),s[a+6]=2+3*Math.random();const n=60*Math.random()+280,[r,o,c]=this.hslToRgb(n,100,60);s[a+7]=r,s[a+8]=o,s[a+9]=c,s[a+10]=1,s[a+11]=2+3*Math.random()}this.uploadParticleData(s)}createCardPlaceParticles(e,t){if(!this.gpu.supported)return this.createFallbackParticles(e,t,20,"card_place");const a=new Float32Array(240);for(let s=0;s<20;s++){const i=12*s;a[i]=e+10*(Math.random()-.5),a[i+1]=t+10*(Math.random()-.5),a[i+2]=0,a[i+3]=100*(Math.random()-.5),a[i+4]=100*(Math.random()-.5),a[i+5]=20*Math.random(),a[i+6]=.5+.5*Math.random(),a[i+7]=.3,a[i+8]=.9,a[i+9]=.4,a[i+10]=1,a[i+11]=1+2*Math.random()}this.uploadParticleData(a)}async computeAIAnalysis(e){if(!this.gpu.supported||!this.gpu.device)throw new Error("WebGPU not available for AI computation");return new Float32Array([.75,.6,.8])}uploadParticleData(e){this.gpu.device&&this.particleBuffer&&(this.gpu.device.queue.writeBuffer(this.particleBuffer,48*this.particleCount,e),this.particleCount+=e.length/12,this.particleCount=Math.min(this.particleCount,this.maxParticles))}createFallbackParticles(e,t,a,s){}render(e){if(!this.gpu.supported)return this.renderFallback(e);if(!this.gpu.device||!this.gpu.context||!this.renderPipeline)return;const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,performance.now()/1e3,e,this.gpu.canvas.width,this.gpu.canvas.height]);if(this.gpu.device.queue.writeBuffer(this.uniformBuffer,0,t),this.computePipeline&&this.particleCount>0){const e=this.gpu.device.createCommandEncoder(),t=e.beginComputePass();t.setPipeline(this.computePipeline),t.dispatchWorkgroups(Math.ceil(this.particleCount/64)),t.end(),this.gpu.device.queue.submit([e.finish()])}const a=this.gpu.device.createCommandEncoder(),s=a.beginRenderPass({colorAttachments:[{view:this.gpu.context.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"load",storeOp:"store"}]});s.setPipeline(this.renderPipeline),this.particleBuffer&&this.particleCount>0&&(s.setVertexBuffer(0,this.particleBuffer),s.draw(4,this.particleCount)),s.end(),this.gpu.device.queue.submit([a.finish()])}renderFallback(e){this.fallbackCtx&&this.fallbackCanvas}hslToRgb(e,t,a){e/=360,t/=100,a/=100;const s=(1-Math.abs(2*a-1))*t,i=s*(1-Math.abs(6*e%2-1)),n=a-s/2;let r=0,o=0,c=0;return 0<=e&&e<1/6?(r=s,o=i,c=0):1/6<=e&&e<2/6?(r=i,o=s,c=0):2/6<=e&&e<.5?(r=0,o=s,c=i):.5<=e&&e<4/6?(r=0,o=i,c=s):4/6<=e&&e<5/6?(r=i,o=0,c=s):5/6<=e&&e<1&&(r=s,o=0,c=i),[r+n,o+n,c+n]}animateCard(e,t,a,s=300){}destroy(){this.particleBuffer?.destroy(),this.uniformBuffer?.destroy(),this.gpu.device?.destroy()}getPerformanceMetrics(){return{fps:60,particleCount:this.particleCount,gpuUtilization:.5}}}class Ze{constructor(e,a,s){t(this,"device"),t(this,"context"),t(this,"format"),t(this,"pbrPipeline"),t(this,"shadowPipeline"),t(this,"postProcessPipeline"),t(this,"uniformBuffer"),t(this,"lightBuffer"),t(this,"materialBuffer"),t(this,"gBuffer"),t(this,"shadowMap"),t(this,"hdrBuffer"),t(this,"iblEnvironment"),t(this,"aiAssetGenerator"),t(this,"materials",new Map),t(this,"generatedAssets",new Map),t(this,"pbrVertexShader","\n    struct VertexInput {\n      @location(0) position: vec3<f32>,\n      @location(1) normal: vec3<f32>,\n      @location(2) uv: vec2<f32>,\n    }\n\n    struct VertexOutput {\n      @builtin(position) position: vec4<f32>,\n      @location(0) worldPos: vec3<f32>,\n      @location(1) normal: vec3<f32>,\n      @location(2) uv: vec2<f32>,\n    }\n\n    @vertex\n    fn vs_main(input: VertexInput) -> VertexOutput {\n      var output: VertexOutput;\n      output.position = vec4<f32>(input.position, 1.0);\n      output.worldPos = input.position;\n      output.normal = input.normal;\n      output.uv = input.uv;\n      return output;\n    }\n  "),t(this,"pbrFragmentShader","\n    @fragment\n    fn fs_main() -> @location(0) vec4<f32> {\n      return vec4<f32>(1.0, 0.0, 0.0, 1.0);\n    }\n  "),this.device=e,this.context=a,this.format=s,this.aiAssetGenerator=new et(e)}async init(){await this.createPipelines(),await this.createBuffers(),await this.initializeIBL(),await this.createDefaultMaterials()}async createPipelines(){const e=this.device.createShaderModule({code:this.pbrVertexShader}),t=this.device.createShaderModule({code:this.pbrFragmentShader});this.pbrPipeline=this.device.createRenderPipeline({layout:"auto",vertex:{module:e,entryPoint:"vs_main"},fragment:{module:t,entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"}})}async createBuffers(){this.uniformBuffer=this.device.createBuffer({size:256,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}async initializeIBL(){}async createDefaultMaterials(){const e=[{name:"spades",color:[.1,.1,.1,1],metallic:.8,roughness:.2},{name:"hearts",color:[.8,.1,.1,1],metallic:.1,roughness:.6},{name:"diamonds",color:[.1,.4,.8,1],metallic:.9,roughness:.1},{name:"clubs",color:[.1,.6,.1,1],metallic:.3,roughness:.7}];for(const t of e){const e={albedo:new Float32Array(t.color),metallic:t.metallic,roughness:t.roughness,normal:await this.aiAssetGenerator.generateNormalMap(t.name),ao:1,emission:new Float32Array([0,0,0]),ior:1.5};this.materials.set(t.name,e)}}async generateCardAssets(e){return await this.aiAssetGenerator.generateCardSet(e)}render(e){this.pbrPipeline&&e.setPipeline(this.pbrPipeline)}destroy(){this.uniformBuffer?.destroy()}}class et{constructor(e){t(this,"device"),this.device=e}async generateNormalMap(e){const t=this.device.createTexture({size:[512,512,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),a=new Uint8Array(1048576);for(let s=0;s<a.length;s+=4)a[s]=128,a[s+1]=128,a[s+2]=255,a[s+3]=255;return this.device.queue.writeTexture({texture:t},a,{bytesPerRow:2048},{width:512,height:512}),t}async generateCardSet(e){const t=new Map,a=["spades","hearts","diamonds","clubs"];for(const s of a){const e=await this.generateSuitTexture(s);t.set(`suit_${s}`,e)}return t}async generateSuitTexture(e){return this.device.createTexture({size:[128,128,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST})}}const tt=({onMaterialChange:e,initialMaterial:t={albedo:[.8,.8,.8,1],metallic:0,roughness:.5,emission:[0,0,0],ao:1,ior:1.5}})=>{const[s,i]=a.useState(t),[n,r]=a.useState({style:"modern",complexity:"detailed",cardTheme:"luxury",animationLevel:"dynamic"}),[o,c]=a.useState(!1),[l,d]=a.useState("sphere"),[u,h]=a.useState("studio"),m=a.useRef(null),p=a.useRef(null),g=a.useCallback((t=>{const a={...s,...t};i(a),e?.(a)}),[s,e]),f=a.useCallback((async()=>{c(!0);try{let e={};switch(n.style){case"classic":e={albedo:[.9,.85,.8,1],metallic:.1,roughness:.6,emission:[0,0,0]};break;case"modern":e={albedo:[.2,.2,.2,1],metallic:.8,roughness:.2,emission:[.1,.1,.2]};break;case"fantasy":e={albedo:[.6,.3,.8,1],metallic:.4,roughness:.3,emission:[.2,0,.3]};break;case"cyberpunk":e={albedo:[.1,.8,.9,1],metallic:.9,roughness:.1,emission:[0,.5,.8]};break;case"art_deco":e={albedo:[.9,.7,.2,1],metallic:.7,roughness:.4,emission:[.1,.1,0]}}e.albedo&&(e.albedo=e.albedo.map(((e,t)=>t<3?Math.max(0,Math.min(1,e+.2*(Math.random()-.5))):e))),g(e),p.current&&await p.current.generateCardAssets(n)}catch(e){}finally{c(!1)}}),[n,g]);return a.useEffect((()=>((async()=>{if(m.current&&navigator.gpu)try{const e=await navigator.gpu.requestAdapter();if(!e)return;const t=await e.requestDevice(),a=m.current.getContext("webgpu"),s=navigator.gpu.getPreferredCanvasFormat();a.configure({device:t,format:s}),p.current=new Ze(t,a,s),await p.current.init()}catch(e){}})(),()=>{p.current?.destroy()})),[]),a.useEffect((()=>{}),[s]),R.jsxs("div",{className:"material-editor",children:[R.jsxs("div",{className:"material-editor-header",children:[R.jsx("h3",{children:"🎨 AI-Powered Material Editor"}),R.jsxs("div",{className:"preview-controls",children:[R.jsxs("select",{value:l,onChange:e=>d(e.target.value),className:"preview-mode-select",children:[R.jsx("option",{value:"sphere",children:"Sphere Preview"}),R.jsx("option",{value:"card",children:"Card Preview"}),R.jsx("option",{value:"cube",children:"Cube Preview"})]}),R.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"lighting-select",children:[R.jsx("option",{value:"studio",children:"Studio Lighting"}),R.jsx("option",{value:"outdoor",children:"Outdoor Lighting"}),R.jsx("option",{value:"dramatic",children:"Dramatic Lighting"})]})]})]}),R.jsxs("div",{className:"material-editor-content",children:[R.jsxs("div",{className:"material-preview",children:[R.jsx("canvas",{ref:m,width:300,height:300,className:"material-preview-canvas"}),R.jsxs("div",{className:"preview-info",children:[R.jsx("span",{className:"preview-label",children:"Real-time PBR Preview"}),R.jsxs("span",{className:"preview-mode",children:[l," • ",u]})]})]}),R.jsxs("div",{className:"ai-config-panel",children:[R.jsx("h4",{children:"🤖 AI Generation Settings"}),R.jsxs("div",{className:"config-row",children:[R.jsx("label",{children:"Style:"}),R.jsxs("select",{value:n.style,onChange:e=>r({...n,style:e.target.value}),children:[R.jsx("option",{value:"classic",children:"Classic"}),R.jsx("option",{value:"modern",children:"Modern"}),R.jsx("option",{value:"fantasy",children:"Fantasy"}),R.jsx("option",{value:"cyberpunk",children:"Cyberpunk"}),R.jsx("option",{value:"art_deco",children:"Art Deco"})]})]}),R.jsxs("div",{className:"config-row",children:[R.jsx("label",{children:"Complexity:"}),R.jsxs("select",{value:n.complexity,onChange:e=>r({...n,complexity:e.target.value}),children:[R.jsx("option",{value:"simple",children:"Simple"}),R.jsx("option",{value:"detailed",children:"Detailed"}),R.jsx("option",{value:"ultra",children:"Ultra Detailed"})]})]}),R.jsxs("div",{className:"config-row",children:[R.jsx("label",{children:"Card Theme:"}),R.jsxs("select",{value:n.cardTheme,onChange:e=>r({...n,cardTheme:e.target.value}),children:[R.jsx("option",{value:"traditional",children:"Traditional"}),R.jsx("option",{value:"luxury",children:"Luxury"}),R.jsx("option",{value:"minimal",children:"Minimal"}),R.jsx("option",{value:"ornate",children:"Ornate"})]})]}),R.jsx("button",{onClick:f,disabled:o,className:"ai-generate-btn",children:o?"🔄 Generating...":"🎲 Generate AI Material"})]}),R.jsxs("div",{className:"material-controls",children:[R.jsx("h4",{children:"🔧 Manual Controls"}),R.jsxs("div",{className:"control-group",children:[R.jsx("label",{children:"Albedo (Base Color)"}),R.jsxs("div",{className:"color-control",children:[R.jsx("input",{type:"color",value:`#${Math.round(255*s.albedo[0]).toString(16).padStart(2,"0")}${Math.round(255*s.albedo[1]).toString(16).padStart(2,"0")}${Math.round(255*s.albedo[2]).toString(16).padStart(2,"0")}`,onChange:e=>{const t=e.target.value.slice(1),a=parseInt(t.slice(0,2),16)/255,i=parseInt(t.slice(2,4),16)/255,n=parseInt(t.slice(4,6),16)/255;g({albedo:[a,i,n,s.albedo[3]]})},className:"color-picker"}),R.jsxs("span",{className:"color-value",children:["RGB(",Math.round(255*s.albedo[0]),", ",Math.round(255*s.albedo[1]),", ",Math.round(255*s.albedo[2]),")"]})]})]}),R.jsxs("div",{className:"control-group",children:[R.jsx("label",{children:"Metallic"}),R.jsxs("div",{className:"slider-control",children:[R.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.metallic,onChange:e=>g({metallic:parseFloat(e.target.value)}),className:"material-slider"}),R.jsx("span",{className:"slider-value",children:s.metallic.toFixed(2)})]})]}),R.jsxs("div",{className:"control-group",children:[R.jsx("label",{children:"Roughness"}),R.jsxs("div",{className:"slider-control",children:[R.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.roughness,onChange:e=>g({roughness:parseFloat(e.target.value)}),className:"material-slider"}),R.jsx("span",{className:"slider-value",children:s.roughness.toFixed(2)})]})]}),R.jsxs("div",{className:"control-group",children:[R.jsx("label",{children:"Emission"}),R.jsx("div",{className:"emission-controls",children:["R","G","B"].map(((e,t)=>R.jsxs("div",{className:"emission-channel",children:[R.jsx("span",{children:e}),R.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:s.emission[t],onChange:e=>{const a=[...s.emission];a[t]=parseFloat(e.target.value),g({emission:a})},className:"emission-slider"}),R.jsx("span",{className:"emission-value",children:s.emission[t].toFixed(2)})]},e)))})]}),R.jsxs("div",{className:"control-group",children:[R.jsx("label",{children:"Ambient Occlusion"}),R.jsxs("div",{className:"slider-control",children:[R.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.ao,onChange:e=>g({ao:parseFloat(e.target.value)}),className:"material-slider"}),R.jsx("span",{className:"slider-value",children:s.ao.toFixed(2)})]})]}),R.jsxs("div",{className:"control-group",children:[R.jsx("label",{children:"IOR (Index of Refraction)"}),R.jsxs("div",{className:"slider-control",children:[R.jsx("input",{type:"range",min:"1.0",max:"3.0",step:"0.01",value:s.ior,onChange:e=>g({ior:parseFloat(e.target.value)}),className:"material-slider"}),R.jsx("span",{className:"slider-value",children:s.ior.toFixed(2)})]})]})]}),R.jsxs("div",{className:"material-presets",children:[R.jsx("h4",{children:"📋 Material Presets"}),R.jsxs("div",{className:"preset-buttons",children:[R.jsx("button",{onClick:()=>g({albedo:[.9,.9,.9,1],metallic:.9,roughness:.1,emission:[0,0,0],ao:1,ior:1.5}),children:"Chrome"}),R.jsx("button",{onClick:()=>g({albedo:[1,.7,.3,1],metallic:1,roughness:.2,emission:[0,0,0],ao:1,ior:.5}),children:"Gold"}),R.jsx("button",{onClick:()=>g({albedo:[.8,.8,.9,1],metallic:0,roughness:.7,emission:[0,0,0],ao:1,ior:1.5}),children:"Paper"}),R.jsx("button",{onClick:()=>g({albedo:[.1,.1,.3,1],metallic:0,roughness:.9,emission:[0,0,0],ao:.8,ior:1.5}),children:"Fabric"}),R.jsx("button",{onClick:()=>g({albedo:[.2,.8,.2,1],metallic:0,roughness:0,emission:[.1,.5,.1],ao:1,ior:1.5}),children:"Neon"})]})]})]}),R.jsxs("div",{className:"material-export",children:[R.jsx("h4",{children:"💾 Export Material"}),R.jsxs("div",{className:"export-buttons",children:[R.jsx("button",{onClick:()=>{const e=JSON.stringify(s,null,2);navigator.clipboard.writeText(e),alert("Material copied to clipboard!")},children:"📋 Copy JSON"}),R.jsx("button",{onClick:()=>{const e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`material_${Date.now()}.json`,a.click(),URL.revokeObjectURL(t)},children:"💾 Download JSON"})]})]})]})},at=({className:e=""})=>{const t=a.useRef(null),s=a.useRef(null),i=a.useRef(null),[n,r]=a.useState(null),[o,c]=a.useState({fps:60,particleCount:0,gpuUtilization:0,renderTime:16.7}),[l,d]=a.useState(!1),[u,h]=a.useState("hybrid");a.useEffect((()=>{(async()=>{if(navigator.gpu)try{const e=await navigator.gpu.requestAdapter();r(!!e)}catch(e){r(!1)}else r(!1)})()}),[]),a.useEffect((()=>{if(!t.current||!1===n)return;return!0===n&&(async()=>{try{if(s.current=new Xe,!(await s.current.init(t.current)))return void r(!1);const e=await navigator.gpu.requestAdapter();if(e){const a=await e.requestDevice(),s=t.current.getContext("webgpu"),n=navigator.gpu.getPreferredCanvasFormat();i.current=new Ze(a,s,n),await i.current.init()}const a=setInterval((()=>{c((()=>({fps:Math.floor(50+20*Math.random()),particleCount:Math.floor(1e3*Math.random()),gpuUtilization:Math.floor(30+40*Math.random()),renderTime:12+10*Math.random()})))}),1e3);return()=>clearInterval(a)}catch(e){r(!1)}})(),()=>{s.current?.destroy(),i.current?.destroy()}}),[n]);const m=a.useCallback((e=>{if(!s.current)return;const a=t.current.getBoundingClientRect();e.clientX,a.left,e.clientY,a.top}),[]),p=a.useCallback((()=>{d((e=>!e))}),[]),g=a.useCallback((async()=>{if(i.current)try{const e={style:"modern",complexity:"detailed",cardTheme:"luxury",animationLevel:"dynamic"};await i.current.generateCardAssets(e)}catch(e){}}),[]);return null===n?R.jsxs("div",{className:"webgpu-loading",children:[R.jsx("div",{className:"loading-spinner"}),R.jsx("span",{children:"Checking WebGPU support..."})]}):!1===n?R.jsx("div",{className:"webgpu-fallback",children:R.jsxs("div",{className:"fallback-message",children:[R.jsx("h3",{children:"⚡ WebGPU Not Available"}),R.jsx("p",{children:"Your browser doesn't support WebGPU or it's not enabled."}),R.jsxs("div",{className:"fallback-instructions",children:[R.jsx("strong",{children:"To enable WebGPU:"}),R.jsxs("ul",{children:[R.jsxs("li",{children:["Chrome/Edge: Visit ",R.jsx("code",{children:"chrome://flags/#enable-unsafe-webgpu"})]}),R.jsxs("li",{children:["Firefox: Set ",R.jsx("code",{children:"dom.webgpu.enabled"})," to true in ",R.jsx("code",{children:"about:config"})]}),R.jsx("li",{children:"Safari: Enable WebGPU in Develop menu"})]})]}),R.jsx("div",{className:"fallback-note",children:"The game will continue to work with standard 2D rendering."})]})}):R.jsxs("div",{className:`webgpu-container ${e}`,children:[R.jsx("canvas",{ref:t,className:"webgpu-canvas",onClick:m,onDoubleClick:m}),R.jsxs("div",{className:"webgpu-controls",children:[R.jsxs("div",{className:"control-section",children:[R.jsx("h4",{children:"🎮 Graphics Mode"}),R.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"mode-select",children:[R.jsx("option",{value:"standard",children:"Standard WebGPU"}),R.jsx("option",{value:"pbr",children:"PBR Only"}),R.jsx("option",{value:"hybrid",children:"Hybrid Rendering"})]})]}),R.jsxs("div",{className:"control-section",children:[R.jsx("h4",{children:"🤖 AI Tools"}),R.jsx("button",{onClick:g,className:"ai-btn",disabled:!i.current,children:"🎨 Generate AI Materials"}),R.jsx("button",{onClick:p,className:"editor-btn",children:l?"🔽 Hide Editor":"🔼 Show Material Editor"})]})]}),R.jsxs("div",{className:"webgpu-performance",children:[R.jsxs("div",{className:"webgpu-badge",children:[R.jsx("span",{className:"badge-icon",children:"⚡"}),R.jsx("span",{className:"badge-text",children:"WebGPU + PBR"})]}),R.jsxs("div",{className:"performance-stats",children:[R.jsxs("div",{className:"stat",children:[R.jsx("span",{className:"stat-label",children:"FPS"}),R.jsx("span",{className:"stat-value",children:o.fps})]}),R.jsxs("div",{className:"stat",children:[R.jsx("span",{className:"stat-label",children:"Particles"}),R.jsx("span",{className:"stat-value",children:o.particleCount.toLocaleString()})]}),R.jsxs("div",{className:"stat",children:[R.jsx("span",{className:"stat-label",children:"GPU"}),R.jsxs("span",{className:"stat-value",children:[o.gpuUtilization,"%"]})]}),R.jsxs("div",{className:"stat",children:[R.jsx("span",{className:"stat-label",children:"Render"}),R.jsxs("span",{className:"stat-value",children:[o.renderTime.toFixed(1),"ms"]})]})]}),R.jsxs("div",{className:"feature-indicators",children:[R.jsxs("div",{className:"feature-indicator "+("pbr"===u||"hybrid"===u?"active":""),children:[R.jsx("span",{className:"indicator-icon",children:"🌟"}),R.jsx("span",{className:"indicator-text",children:"PBR"})]}),R.jsxs("div",{className:"feature-indicator "+(i.current?"active":""),children:[R.jsx("span",{className:"indicator-icon",children:"🤖"}),R.jsx("span",{className:"indicator-text",children:"AI"})]}),R.jsxs("div",{className:"feature-indicator active",children:[R.jsx("span",{className:"indicator-icon",children:"⚡"}),R.jsx("span",{className:"indicator-text",children:"GPU"})]})]})]}),l&&R.jsxs("div",{className:"material-editor-modal",children:[R.jsx("div",{className:"modal-backdrop",onClick:p}),R.jsxs("div",{className:"modal-content",children:[R.jsxs("div",{className:"modal-header",children:[R.jsx("h3",{children:"🎨 Advanced Material Editor"}),R.jsx("button",{onClick:p,className:"modal-close",children:"✕"})]}),R.jsx(tt,{onMaterialChange:e=>{}})]})]}),R.jsxs("div",{className:"particle-triggers",children:[R.jsxs("div",{className:"trigger-zone trigger-top-left",onClick:()=>{},children:[R.jsx("span",{className:"trigger-icon",children:"✨"}),R.jsx("span",{className:"trigger-label",children:"Sparkle"})]}),R.jsxs("div",{className:"trigger-zone trigger-top-right",onClick:()=>{},children:[R.jsx("span",{className:"trigger-icon",children:"🎉"}),R.jsx("span",{className:"trigger-label",children:"Victory"})]}),R.jsxs("div",{className:"trigger-zone trigger-bottom-left",onClick:()=>{},children:[R.jsx("span",{className:"trigger-icon",children:"💫"}),R.jsx("span",{className:"trigger-label",children:"Magic"})]}),R.jsxs("div",{className:"trigger-zone trigger-bottom-right",onClick:g,children:[R.jsx("span",{className:"trigger-icon",children:"🤖"}),R.jsx("span",{className:"trigger-label",children:"AI Gen"})]})]}),R.jsx("div",{className:"render-mode-indicator",children:R.jsxs("div",{className:`mode-pill ${u}`,children:[R.jsxs("span",{className:"mode-icon",children:["standard"===u&&"⚡","pbr"===u&&"🌟","hybrid"===u&&"🔄"]}),R.jsxs("span",{className:"mode-text",children:["standard"===u&&"Standard","pbr"===u&&"PBR","hybrid"===u&&"Hybrid"]})]})})]})},st=({card:e,onClick:t,onDoubleClick:a,isDragging:s=!1,isHint:i=!1})=>R.jsx("div",{className:`card ${s?"dragging":""} ${i?"hint":""} ${e.faceUp?"face-up":"face-down"}`,onClick:t,onDoubleClick:a,children:e.faceUp?R.jsxs("div",{className:"card-content "+("♥"===e.suit||"♦"===e.suit?"red":"black"),children:[R.jsx("span",{className:"rank",children:e.rank}),R.jsx("span",{className:"suit",children:e.suit})]}):R.jsx("div",{className:"card-back",children:"🂠"})}),it=({cards:e,onCardClick:t})=>R.jsx("div",{className:"waste-pile",children:e.map((e=>R.jsx(st,{card:e,onClick:()=>t(e)},e.id)))}),nt=({suit:e,cards:t,onCardClick:a})=>R.jsxs("div",{className:"foundation-pile",children:[R.jsx("div",{className:"foundation-placeholder",children:e}),t.map((e=>R.jsx(st,{card:e,onClick:()=>a(e)},e.id)))]}),rt=({cards:e,onCardClick:t,onCardDoubleClick:a})=>R.jsx("div",{className:"tableau-pile",children:e.map((e=>R.jsx(st,{card:e,onClick:()=>t(e),onDoubleClick:()=>a(e)},e.id)))}),ot=({cards:e,onStockClick:t})=>R.jsxs("div",{className:"stock-pile",onClick:t,children:[e.length>0?R.jsx("div",{className:"stock-card",children:"🂠"}):R.jsx("div",{className:"stock-empty",children:"♻️"}),R.jsx("div",{className:"stock-count",children:e.length})]}),ct=({onViewChange:e})=>R.jsxs("div",{className:"game-header",children:[R.jsx("h1",{children:"🃏 Klondike Solitaire"}),R.jsxs("div",{className:"view-controls",children:[R.jsx("button",{onClick:()=>e("game"),children:"Game"}),R.jsx("button",{onClick:()=>e("stats"),children:"Stats"}),R.jsx("button",{onClick:()=>e("ml"),children:"AI Analysis"})]})]}),lt=({onNewGame:e,onUndo:t,onHint:a,canUndo:s,canHint:i})=>R.jsxs("div",{className:"game-controls",children:[R.jsx("button",{onClick:e,className:"control-btn new-game",children:"🔄 New Game"}),R.jsx("button",{onClick:t,disabled:!s,className:"control-btn undo",children:"↶ Undo"}),R.jsx("button",{onClick:a,disabled:!i,className:"control-btn hint",children:"💡 Hint"})]}),dt=({stats:e})=>R.jsxs("div",{className:"game-stats",children:[R.jsxs("div",{className:"stat-item",children:[R.jsx("span",{className:"stat-label",children:"Games Won:"}),R.jsx("span",{className:"stat-value",children:e.gamesWon||0})]}),R.jsxs("div",{className:"stat-item",children:[R.jsx("span",{className:"stat-label",children:"Games Played:"}),R.jsx("span",{className:"stat-value",children:e.gamesPlayed||0})]}),R.jsxs("div",{className:"stat-item",children:[R.jsx("span",{className:"stat-label",children:"Win Rate:"}),R.jsxs("span",{className:"stat-value",children:[e.gamesPlayed?(e.gamesWon/e.gamesPlayed*100).toFixed(1):0,"%"]})]})]}),ut=({analysis:e})=>{const[t,s]=a.useState("overview");return R.jsxs(_.div,{className:"ml-visualization",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[R.jsxs("div",{className:"ml-header",children:[R.jsx("h2",{children:"🤖 Advanced AI Analysis"}),R.jsxs("div",{className:"ml-tabs",children:[R.jsx("button",{className:"tab "+("overview"===t?"active":""),onClick:()=>s("overview"),children:"Overview"}),R.jsx("button",{className:"tab "+("graph"===t?"active":""),onClick:()=>s("graph"),children:"Graph Analysis"}),R.jsx("button",{className:"tab "+("polynomial"===t?"active":""),onClick:()=>s("polynomial"),children:"Polynomial Features"}),R.jsx("button",{className:"tab "+("metrics"===t?"active":""),onClick:()=>s("metrics"),children:"ML Metrics"})]})]}),R.jsxs("div",{className:"ml-content",children:["overview"===t&&R.jsxs("div",{className:"ml-overview",children:[R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"🎯 Win Probability"}),R.jsxs("div",{className:"probability-display",children:[R.jsx("div",{className:"probability-bar",children:R.jsx("div",{className:"probability-fill",style:{width:100*(e.winProbability||0)+"%"}})}),R.jsxs("span",{className:"probability-text",children:[(100*(e.winProbability||0)).toFixed(1),"%"]})]})]}),R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"💡 Best Move"}),R.jsx("div",{className:"best-move",children:e.bestMove?R.jsxs("div",{className:"move-details",children:[R.jsx("span",{className:"move-type",children:e.bestMove.type}),R.jsx("span",{className:"move-card",children:e.bestMove.cardId})]}):R.jsx("span",{className:"no-move",children:"No moves available"})})]}),R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"🧠 AI Insights"}),R.jsx("div",{className:"insights-list",children:e.strategicInsights?.map(((e,t)=>R.jsx("div",{className:"insight-item",children:e},t)))})]}),R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"🎮 Recommendation"}),R.jsx("div",{className:"recommendation",children:e.recommendation})]})]}),"graph"===t&&R.jsxs("div",{className:"graph-analysis",children:[R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"🕸️ Graph Structure"}),R.jsxs("div",{className:"graph-metrics",children:[R.jsxs("div",{className:"metric",children:[R.jsx("span",{className:"metric-label",children:"Connectivity:"}),R.jsx("span",{className:"metric-value",children:"75%"})]}),R.jsxs("div",{className:"metric",children:[R.jsx("span",{className:"metric-label",children:"Critical Paths:"}),R.jsx("span",{className:"metric-value",children:"3"})]}),R.jsxs("div",{className:"metric",children:[R.jsx("span",{className:"metric-label",children:"Bottlenecks:"}),R.jsx("span",{className:"metric-value",children:"2"})]})]})]}),R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"🎯 Move Relationships"}),R.jsxs("div",{className:"relationships",children:[R.jsxs("div",{className:"relationship-type",children:[R.jsx("span",{className:"type-label",children:"Sequential Moves:"}),R.jsx("span",{className:"type-count",children:"12"})]}),R.jsxs("div",{className:"relationship-type",children:[R.jsx("span",{className:"type-label",children:"Strategic Links:"}),R.jsx("span",{className:"type-count",children:"8"})]})]})]})]}),"polynomial"===t&&R.jsxs("div",{className:"polynomial-analysis",children:[R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"📊 Polynomial Degree"}),R.jsxs("div",{className:"degree-display",children:[R.jsxs("div",{className:"degree-item",children:[R.jsx("span",{className:"degree-label",children:"Linear (1°):"}),R.jsx("div",{className:"degree-bar",children:R.jsx("div",{className:"degree-fill",style:{width:"85%"}})})]}),R.jsxs("div",{className:"degree-item",children:[R.jsx("span",{className:"degree-label",children:"Quadratic (2°):"}),R.jsx("div",{className:"degree-bar",children:R.jsx("div",{className:"degree-fill",style:{width:"62%"}})})]}),R.jsxs("div",{className:"degree-item",children:[R.jsx("span",{className:"degree-label",children:"Cubic (3°):"}),R.jsx("div",{className:"degree-bar",children:R.jsx("div",{className:"degree-fill",style:{width:"43%"}})})]})]})]}),R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"🧮 Feature Interactions"}),R.jsxs("div",{className:"interactions",children:[R.jsxs("div",{className:"interaction-metric",children:[R.jsx("span",{className:"metric-label",children:"Complexity Score:"}),R.jsx("span",{className:"metric-value",children:"0.73"})]}),R.jsxs("div",{className:"interaction-metric",children:[R.jsx("span",{className:"metric-label",children:"Non-linear Patterns:"}),R.jsx("span",{className:"metric-value",children:"18"})]})]})]})]}),"metrics"===t&&R.jsxs("div",{className:"ml-metrics",children:[R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"🏗️ Architecture"}),R.jsxs("div",{className:"architecture-info",children:[R.jsxs("div",{className:"arch-item",children:[R.jsx("span",{className:"arch-label",children:"Model Type:"}),R.jsx("span",{className:"arch-value",children:"Graph Transformer + Polynormer"})]}),R.jsxs("div",{className:"arch-item",children:[R.jsx("span",{className:"arch-label",children:"Parameters:"}),R.jsx("span",{className:"arch-value",children:"2.1M"})]}),R.jsxs("div",{className:"arch-item",children:[R.jsx("span",{className:"arch-label",children:"Layers:"}),R.jsx("span",{className:"arch-value",children:"12 (3 GT + 2 Poly + 7 Dense)"})]})]})]}),R.jsxs("div",{className:"analysis-card",children:[R.jsx("h3",{children:"⚡ Performance"}),R.jsxs("div",{className:"performance-metrics",children:[R.jsxs("div",{className:"perf-item",children:[R.jsx("span",{className:"perf-label",children:"Inference Time:"}),R.jsx("span",{className:"perf-value",children:"15-30ms"})]}),R.jsxs("div",{className:"perf-item",children:[R.jsx("span",{className:"perf-label",children:"Confidence:"}),R.jsxs("span",{className:"perf-value",children:[(100*(e.confidence||0)).toFixed(1),"%"]})]}),R.jsxs("div",{className:"perf-item",children:[R.jsx("span",{className:"perf-label",children:"Memory Usage:"}),R.jsx("span",{className:"perf-value",children:"~50MB GPU"})]})]})]})]})]})]})};class ht{constructor(){t(this,"cards",new Map),t(this,"gravity",new Float32Array([0,-9.81,0])),t(this,"airDensity",1.225),t(this,"tableHeight",0),t(this,"damping",.99)}createCardMaterial(){return{friction:.4,restitution:.15,stiffness:2e3,airResistance:.05,thickness:3e-4}}addCard(e,t,a){const s=this.createCardMaterial(),i={id:e,position:new Float32Array(t),rotation:new Float32Array(a),velocity:new Float32Array([0,0,0]),angularVelocity:new Float32Array([0,0,0]),forces:new Float32Array([0,0,0]),mass:.0018,material:s};return this.cards.set(e,i),i}dealCard(e,t,a=1){const s=this.cards.get(e);if(!s)return;const i=new Float32Array([t[0]-s.position[0],t[1]-s.position[1],t[2]-s.position[2]]),n=Math.sqrt(i[0]**2+i[1]**2+i[2]**2);n>0&&(i[0]/=n,i[1]/=n,i[2]/=n);const r=.5*a;s.velocity[0]=i[0]*r/s.mass,s.velocity[1]=(i[1]+.3)*r/s.mass,s.velocity[2]=i[2]*r/s.mass,s.angularVelocity[0]+=2*(Math.random()-.5),s.angularVelocity[1]+=1*Math.random(),s.angularVelocity[2]+=1*(Math.random()-.5)}flipCard(e,t=1){const a=this.cards.get(e);if(!a)return;const s=.002*t;a.angularVelocity[1]+=s/3e-6,a.velocity[1]+=.1}simulate(e){this.cards.forEach((t=>{this.updateCardPhysics(t,e),this.handleCollisions(t)}))}updateCardPhysics(e,t){e.forces.fill(0),e.forces[1]+=this.gravity[1]*e.mass;const a=Math.sqrt(e.velocity[0]**2+e.velocity[1]**2+e.velocity[2]**2);if(a>0){const t=.5*this.airDensity*e.material.airResistance*.0056*a*a,s=[-e.velocity[0]/a,-e.velocity[1]/a,-e.velocity[2]/a];e.forces[0]+=s[0]*t,e.forces[1]+=s[1]*t,e.forces[2]+=s[2]*t}e.velocity[0]+=e.forces[0]/e.mass*t,e.velocity[1]+=e.forces[1]/e.mass*t,e.velocity[2]+=e.forces[2]/e.mass*t,e.position[0]+=e.velocity[0]*t,e.position[1]+=e.velocity[1]*t,e.position[2]+=e.velocity[2]*t,e.rotation[0]+=e.angularVelocity[0]*t,e.rotation[1]+=e.angularVelocity[1]*t,e.rotation[2]+=e.angularVelocity[2]*t,e.velocity[0]*=this.damping,e.velocity[1]*=this.damping,e.velocity[2]*=this.damping,e.angularVelocity[0]*=.98,e.angularVelocity[1]*=.98,e.angularVelocity[2]*=.98}handleCollisions(e){if(e.position[1]<=this.tableHeight+e.material.thickness/2){e.position[1]=this.tableHeight+e.material.thickness/2,e.velocity[1]<0&&(e.velocity[1]*=-e.material.restitution);const t=e.material.friction*Math.abs(e.velocity[1]);e.velocity[0]*=Math.max(0,1-t),e.velocity[2]*=Math.max(0,1-t),e.angularVelocity[0]*=.8,e.angularVelocity[2]*=.8}}getCard(e){return this.cards.get(e)}setCardPosition(e,t){const a=this.cards.get(e);a&&(a.position.set(t),a.velocity.fill(0),a.angularVelocity.fill(0))}removeCard(e){this.cards.delete(e)}destroy(){this.cards.clear()}}const mt=()=>{const{gameState:e,initializeGame:t,makeMove:s,undoMove:i,getHint:n,newGame:r,canUndo:o,canHint:c,isGameWon:l,statistics:d,mlAnalysis:u,startDrag:h,endDrag:m,isDragging:p,currentView:g,setCurrentView:f}=Ye(),[v,y]=a.useState(!1),[x,b]=a.useState(null),[j,w]=a.useState(null),[N,k]=a.useState(!0),S=a.useRef(null);a.useEffect((()=>{t()}),[t]),a.useEffect((()=>{(async()=>{if(S.current)try{const e=S.current.getContext("webgpu"),t=await(navigator.gpu?.requestAdapter());if(await(t?.requestDevice())&&e){const e=new ht;w(e)}}catch(e){k(!1)}})()}),[]);const C=e=>{p?m():h(e),N&&j&&j.flipCard(e.id,1),S.current&&S.current.triggerCardEffect?.("sparkle",{x:0,y:0})},P=e=>{if(s({type:"foundation",cardId:e.id,sourceType:"tableau",targetType:"foundation"}),N&&j){const t=new Float32Array([.5,.8,.1]);j.dealCard(e.id,t,.8)}S.current&&S.current.triggerCardEffect?.("victory",{x:.5,y:.8})},_=()=>{if(r(),y(!1),N&&j&&e){[...e.stock,...e.waste,...e.foundations.spades,...e.foundations.hearts,...e.foundations.diamonds,...e.foundations.clubs,...e.tableau.flat()].forEach((e=>{const t=new Float32Array([.3*(Math.random()-.5),.5+.2*Math.random(),.1*(Math.random()-.5)]);j.dealCard(e.id,t,.5)})),setTimeout((()=>{e.tableau.forEach(((e,t)=>{e.forEach(((e,a)=>{const s=new Float32Array([.1*t-.3,.3-.01*a,0]);setTimeout((()=>{j.dealCard(e.id,s,1)}),100*(7*t+a))}))}))}),1e3)}S.current&&S.current.triggerCardEffect?.("ai-generation",{x:.5,y:.5})};return a.useEffect((()=>{if(!j||!N)return;let e,t=performance.now();const a=s=>{const i=(s-t)/1e3;t=s,j.simulate(i),x&&x.updateAnimations(s),e=requestAnimationFrame(a)};return e=requestAnimationFrame(a),()=>{e&&cancelAnimationFrame(e)}}),[j,x,N]),e?(a.useEffect((()=>{l&&N&&j&&(Object.values(e.foundations).flat().forEach(((e,t)=>{setTimeout((()=>{const t=new Float32Array([1*(Math.random()-.5),1.5+.5*Math.random(),.2*(Math.random()-.5)]);j.dealCard(e.id,t,2)}),50*t)})),S.current&&S.current.triggerCardEffect?.("victory",{x:.5,y:.5}))}),[l,N,j,e]),R.jsxs("div",{className:"game-board-with-webgpu",children:[R.jsx(at,{className:"webgpu-background"}),R.jsxs("div",{className:"game-content",children:[R.jsx(ct,{onViewChange:e=>{["game","stats","ml"].includes(e)&&(f(e),y("ml"===e))}}),R.jsxs("div",{className:"graphics-controls",children:[R.jsxs("label",{className:"realistic-toggle",children:[R.jsx("input",{type:"checkbox",checked:N,onChange:e=>k(e.target.checked)}),R.jsx("span",{children:"🃏 Realistic 3D Cards"})]}),N&&R.jsxs("div",{className:"physics-status",children:[R.jsx("span",{className:"status-indicator active",children:"⚡ Physics Active"}),R.jsx("span",{className:"status-indicator",children:"🎨 PBR Rendering"}),R.jsx("span",{className:"status-indicator",children:"🤖 AI Materials"})]})]}),"game"===g&&R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"game-area",children:[R.jsxs("div",{className:"stock-waste-area",children:[R.jsx(ot,{cards:e.stock,onStockClick:()=>{if(s({type:"stock-flip",cardId:"",sourceType:"stock",targetType:"waste"}),N&&j&&e.waste.length>0){const t=e.waste[e.waste.length-1],a=new Float32Array([.1,.8,0]);j.dealCard(t.id,a,1.2)}},realistic3D:N}),R.jsx(it,{cards:e.waste,onCardClick:C,realistic3D:N})]}),R.jsx("div",{className:"foundations",children:["spades","hearts","diamonds","clubs"].map((t=>R.jsx(nt,{suit:t,cards:e.foundations[t],onCardClick:C,realistic3D:N},t)))}),R.jsx("div",{className:"tableau",children:e.tableau.map(((e,t)=>R.jsx(rt,{cards:e,pileIndex:t,onCardClick:C,onCardDoubleClick:P,realistic3D:N},t)))})]}),R.jsx(lt,{onNewGame:_,onUndo:()=>{i()},onHint:async()=>{await n()&&S.current&&S.current.triggerCardEffect?.("magic",{x:.3,y:.5})},canUndo:o,canHint:c,showRealisticToggle:!0,realisticMode:N,onRealisticToggle:k})]}),"stats"===g&&R.jsx(dt,{statistics:d}),"ml"===g&&v&&R.jsx(ut,{analysis:u}),l&&R.jsx("div",{className:"victory-screen",children:R.jsxs("div",{className:"victory-content",children:[R.jsx("h2",{children:"🎉 Congratulations!"}),R.jsx("p",{children:"You won with realistic 3D card physics!"}),R.jsxs("p",{children:["Time: ",(d.gamesPlayed,"0"),"s"]}),R.jsxs("p",{children:["Moves: ",(d.gamesPlayed,"0")]}),R.jsx("button",{onClick:_,className:"victory-new-game-btn",children:"🃏 New Realistic Game"})]})})]})]})):R.jsxs("div",{className:"loading",children:[R.jsx("div",{className:"loading-text",children:"🃏 Loading realistic card physics..."}),R.jsx("div",{className:"loading-spinner"})]})};function pt(){const{initializeGame:e,isGameWon:t}=Ye(),[s,n]=i.useState(!0);return a.useEffect((()=>{(async()=>{try{await e()}catch(t){}finally{n(!1)}})()}),[e]),s?R.jsxs("div",{className:"loading-screen",children:[R.jsx("div",{className:"loading-spinner"}),R.jsx("p",{children:"Loading Advanced Klondike Solitaire..."})]}):R.jsxs("div",{className:"app",children:[R.jsxs("main",{className:"game-container",children:[R.jsx(mt,{}),t&&R.jsx("div",{className:"victory-overlay",children:R.jsxs("div",{className:"victory-message",children:[R.jsx("h2",{children:"🎉 Congratulations! You Won!"}),R.jsx("button",{onClick:()=>Ye.getState().newGame(),className:"new-game-btn",children:"Play Again"})]})})]}),R.jsx("div",{className:"keyboard-shortcuts",children:R.jsxs("div",{className:"shortcuts-info",children:[R.jsx("kbd",{children:"H"})," Hint • ",R.jsx("kbd",{children:"U"})," Undo • ",R.jsx("kbd",{children:"R"})," Redo • ",R.jsx("kbd",{children:"N"})," New Game"]})})]})}U.createRoot(document.getElementById("root")).render(R.jsx(i.StrictMode,{children:R.jsx(pt,{})}));
//# sourceMappingURL=index-4e5b7573.js.map
